<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PII Redactor</title>
        <style>
            * {
                box-sizing: border-box;
            }
            body {
                font-family:
                    Helvetica,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Arial,
                    sans-serif;
                line-height: 1.6;
                max-width: 980px;
                margin: 0 auto;
                padding: 20px;
                color: #24292e;
                background: #ffffff;
            }
            h1 {
                border-bottom: 1px solid #eaecef;
                padding-bottom: 0.3em;
                margin-top: 0;
                font-size: 32px;
                font-weight: 600;
            }
            .back-link {
                display: inline-block;
                margin-bottom: 16px;
                color: #0366d6;
                text-decoration: none;
                font-size: 14px;
            }
            .back-link:hover {
                text-decoration: underline;
            }
            .controls {
                display: flex;
                gap: 8px;
                align-items: stretch;
                margin-bottom: 4px;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            .btn {
                background: #0366d6;
                color: #fff;
                padding: 8px 12px;
                border-radius: 6px;
                border: 1px solid rgba(27, 31, 35, 0.15);
                cursor: pointer;
                font-size: 14px;
                line-height: 20px;
                height: 36px;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: fit-content;
                font-family:
                    Helvetica,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Arial,
                    sans-serif;
            }
            .btn:hover {
                background: #0256c5;
            }
            .panel {
                background: #f6f8fa;
                padding: 16px;
                border-radius: 6px;
                border: 1px solid #e1e4e8;
                margin-bottom: 0;
                height: fit-content;
            }
            .panel h3 {
                margin-top: 0;
                margin-bottom: 12px;
                font-size: 16px;
                font-weight: 600;
                color: #24292e;
            }
            .options {
                margin-bottom: 8px;
            }
            label {
                font-size: 14px;
                color: #24292e;
                cursor: pointer;
                display: block;
                margin-right: 0;
                margin-bottom: 6px;
            }
            label input[type="checkbox"] {
                margin-right: 6px;
            }
            .input-group {
                margin-bottom: 8px;
            }
            .input-group label {
                display: block;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 6px;
                color: #24292e;
            }
            input[type="text"] {
                width: 100%;
                padding: 8px 12px;
                font-size: 14px;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                font-family:
                    "SFMono-Regular", Consolas, "Liberation Mono", Menlo,
                    monospace;
            }
            input[type="text"]:focus {
                outline: none;
                border-color: #0366d6;
            }
            select {
                width: 100%;
                padding: 8px 12px;
                font-size: 14px;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                background: #ffffff;
                font-family:
                    Helvetica,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Arial,
                    sans-serif;
            }
            select:focus {
                outline: none;
                border-color: #0366d6;
            }
            textarea {
                width: 100%;
                height: 250px;
                font-family:
                    "SFMono-Regular", Consolas, "Liberation Mono", Menlo,
                    monospace;
                font-size: 14px;
                padding: 12px;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                background: #ffffff;
                color: #24292e;
                resize: vertical;
            }
            textarea:focus {
                outline: none;
                border-color: #0366d6;
            }
            textarea.drag-over {
                border-color: #0366d6;
                border-width: 2px;
                background: #f0f7ff;
            }
            .actions {
                margin-top: 12px;
                display: flex;
                gap: 8px;
                justify-content: flex-end;
            }
            .info {
                font-size: 13px;
                color: #586069;
                margin-top: 0;
                margin-bottom: 12px;
                padding: 12px;
                background: #f6f8fa;
                border-radius: 6px;
                border: 1px solid #e1e4e8;
            }
            .stats-bar {
                font-size: 13px;
                color: #24292e;
                margin-top: 12px;
                padding: 10px 12px;
                background: #ffffff;
                border-radius: 6px;
                border: 1px solid #e1e4e8;
                display: flex;
                align-items: center;
                min-height: 36px;
                line-height: 1.5;
            }
            .stats-bar strong {
                color: #0366d6;
            }
            input[type="file"] {
                display: none;
            }
            .section-title {
                font-size: 14px;
                font-weight: 600;
                color: #24292e;
                margin-bottom: 8px;
                margin-top: 16px;
            }

            .main-layout {
                display: grid;
                grid-template-columns: 320px 1fr;
                gap: 16px;
                margin-top: 0;
            }
            .text-areas {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            @media (max-width: 968px) {
                .main-layout {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <a href="index.html" class="back-link">‚Üê Back to Browser Tools</a>

        <h1>PII Redactor</h1>

        <div class="info">
            Automatically detect and redact personally identifiable information
            (emails, phones, IP addresses, URLs, API keys) from text. All
            processing happens locally in your browser.
        </div>

        <div class="main-layout">
            <aside class="panel">
                <h3>Detection Patterns</h3>
                <div class="options">
                    <label>
                        <input type="checkbox" id="checkEmail" checked />
                        Email Addresses
                    </label>
                    <label>
                        <input type="checkbox" id="checkPhone" checked />
                        Phone Numbers
                    </label>
                    <label>
                        <input type="checkbox" id="checkIPV4" />
                        IPv4 Addresses
                    </label>
                    <label>
                        <input type="checkbox" id="checkIPV6" />
                        IPv6 Addresses
                    </label>
                    <label>
                        <input type="checkbox" id="checkURL" />
                        URLs
                    </label>
                    <label>
                        <input type="checkbox" id="checkMAC" />
                        MAC Addresses
                    </label>
                    <label>
                        <input type="checkbox" id="checkAPIKey" />
                        API Keys
                    </label>
                </div>

                <div class="input-group">
                    <label for="customRegex">Custom Regex Pattern</label>
                    <input
                        type="text"
                        id="customRegex"
                        placeholder="e.g., API-KEY-\w+"
                    />
                </div>

                <div class="input-group">
                    <label for="replacementType">Redaction Style</label>
                    <select id="replacementType">
                        <option value="fixed">Fixed String</option>
                        <option value="type">
                            Pattern Name (e.g., [EMAIL])
                        </option>
                    </select>
                </div>

                <div class="input-group" id="fixedTextGroup">
                    <label for="replacementText">Replacement Text</label>
                    <input
                        type="text"
                        id="replacementText"
                        value="[REDACTED]"
                        placeholder="Replacement text"
                    />
                </div>
            </aside>

            <div class="text-areas">
                <div class="controls">
                    <label for="fileInput" class="btn">Upload File</label>
                    <input
                        type="file"
                        id="fileInput"
                        accept=".txt,.log,.csv,.json,.md"
                    />
                    <button class="btn" id="processBtn">Process Text</button>
                </div>

                <div>
                    <div class="section-title">Input Text</div>
                    <textarea
                        id="inputText"
                        placeholder="Paste text here or drag and drop a file..."
                    ></textarea>
                </div>

                <div>
                    <div class="section-title">Redacted Output</div>
                    <textarea id="outputText" readonly></textarea>
                </div>

                <div class="stats-bar" id="statsBar">
                    Ready to process text. Select patterns and click "Process
                    Text".
                </div>

                <div class="actions">
                    <button class="btn" id="copyBtn">Copy to Clipboard</button>
                    <button class="btn" id="downloadBtn">Download</button>
                </div>
            </div>
        </div>

        <script>
            // Regex Patterns
            const PATTERNS = {
                email: {
                    regex: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,
                    name: "EMAIL",
                },
                ipv4: {
                    regex: /\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g,
                    name: "IPV4",
                },
                ipv6: {
                    regex: /\b(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b|\b(?:[0-9a-fA-F]{1,4}:){1,7}:\b|\b(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}\b|\b(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}\b|\b(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}\b|\b(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}\b|\b(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}\b|\b[0-9a-fA-F]{1,4}:(?::[0-9a-fA-F]{1,4}){1,6}\b|\b:(?:(?::[0-9a-fA-F]{1,4}){1,7}|:)\b/g,
                    name: "IPV6",
                },
                phone: {
                    regex: /(?:\+?\d{1,2}\s?)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}\b/g,
                    name: "PHONE",
                },
                url: {
                    regex: /https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)/g,
                    name: "URL",
                },
                mac: {
                    regex: /\b(?:[0-9A-Fa-f]{2}[:-]){5}[0-9A-Fa-f]{2}\b/g,
                    name: "MAC_ADDRESS",
                },
                apiKey: {
                    regex: /\b(?:sk_live_|pk_live_|sk_test_|pk_test_|AIza|ya29\.|AKIA|ghp_|gho_|github_pat_)[a-zA-Z0-9_\-]{20,}/g,
                    name: "API_KEY",
                },
            };

            // UI Elements
            const inputText = document.getElementById("inputText");
            const outputText = document.getElementById("outputText");
            const processBtn = document.getElementById("processBtn");
            const copyBtn = document.getElementById("copyBtn");
            const downloadBtn = document.getElementById("downloadBtn");
            const fileInput = document.getElementById("fileInput");
            const statsBar = document.getElementById("statsBar");
            const replacementTypeSelect =
                document.getElementById("replacementType");
            const replacementTextInput =
                document.getElementById("replacementText");
            const fixedTextGroup = document.getElementById("fixedTextGroup");

            // Checkboxes
            const checkboxes = {
                email: document.getElementById("checkEmail"),
                ipv4: document.getElementById("checkIPV4"),
                ipv6: document.getElementById("checkIPV6"),
                phone: document.getElementById("checkPhone"),
                url: document.getElementById("checkURL"),
                mac: document.getElementById("checkMAC"),
                apiKey: document.getElementById("checkAPIKey"),
            };

            // Toggle fixed text input visibility
            replacementTypeSelect.addEventListener("change", () => {
                fixedTextGroup.style.display =
                    replacementTypeSelect.value === "fixed" ? "block" : "none";
            });

            function redactText() {
                let content = inputText.value;
                if (!content) {
                    statsBar.textContent = "No text to process.";
                    outputText.value = "";
                    return;
                }

                const mode = replacementTypeSelect.value;
                const fixedText = replacementTextInput.value;
                const customRegexStr =
                    document.getElementById("customRegex").value;
                let totalRedactions = 0;
                const stats = {};

                // Helper to replace and count
                const applyReplacement = (regex, typeName) => {
                    let matches = 0;
                    content = content.replace(regex, (match) => {
                        matches++;
                        if (mode === "type") return `[${typeName}]`;
                        return fixedText;
                    });
                    if (matches > 0) {
                        stats[typeName] = (stats[typeName] || 0) + matches;
                        totalRedactions += matches;
                    }
                };

                // Apply built-in patterns
                Object.keys(checkboxes).forEach((key) => {
                    if (checkboxes[key].checked) {
                        applyReplacement(
                            PATTERNS[key].regex,
                            PATTERNS[key].name,
                        );
                    }
                });

                // Apply custom regex
                if (customRegexStr) {
                    try {
                        const customRegex = new RegExp(customRegexStr, "g");
                        applyReplacement(customRegex, "CUSTOM");
                    } catch (e) {
                        console.error("Invalid custom regex", e);
                        statsBar.textContent =
                            "Error: Invalid custom regex pattern.";
                        return;
                    }
                }

                outputText.value = content;

                // Update stats
                if (totalRedactions === 0) {
                    statsBar.textContent = "No matches found.";
                } else {
                    const details = Object.entries(stats)
                        .map(
                            ([name, count]) =>
                                `<strong>&nbsp;${count}</strong>&nbsp;${name}`,
                        )
                        .join(", ");
                    statsBar.innerHTML = `Redacted&nbsp;<strong>${totalRedactions}</strong>&nbsp;item${totalRedactions !== 1 ? "s" : ""}: ${details}`;
                }
            }

            // Event Handlers
            processBtn.addEventListener("click", redactText);

            // Copy
            copyBtn.addEventListener("click", async () => {
                if (!outputText.value) {
                    alert("No text to copy.");
                    return;
                }
                try {
                    await navigator.clipboard.writeText(outputText.value);
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = "Copied!";
                    setTimeout(
                        () => (copyBtn.textContent = originalText),
                        2000,
                    );
                } catch (err) {
                    // Fallback for older browsers
                    outputText.select();
                    document.execCommand("copy");
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = "Copied!";
                    setTimeout(
                        () => (copyBtn.textContent = originalText),
                        2000,
                    );
                }
            });

            // Download
            downloadBtn.addEventListener("click", () => {
                if (!outputText.value) {
                    alert("No text to download.");
                    return;
                }
                const blob = new Blob([outputText.value], {
                    type: "text/plain",
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "redacted-text.txt";
                a.click();
                URL.revokeObjectURL(url);
            });

            // File Handling
            function handleFile(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    inputText.value = e.target.result;
                };
                reader.readAsText(file);
            }

            fileInput.addEventListener("change", (e) => {
                if (e.target.files.length) handleFile(e.target.files[0]);
            });

            // Drag and Drop
            ["dragenter", "dragover", "dragleave", "drop"].forEach(
                (eventName) => {
                    inputText.addEventListener(
                        eventName,
                        preventDefaults,
                        false,
                    );
                },
            );

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            inputText.addEventListener("dragover", () =>
                inputText.classList.add("drag-over"),
            );
            inputText.addEventListener("dragleave", () =>
                inputText.classList.remove("drag-over"),
            );
            inputText.addEventListener("drop", (e) => {
                inputText.classList.remove("drag-over");
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length) handleFile(files[0]);
            });
        </script>
    </body>
</html>
