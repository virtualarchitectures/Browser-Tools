<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Localhost Port Scanner</title>
        <style>
            /* =========================
         CSS Styles
         ========================= */

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    Helvetica,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Arial,
                    sans-serif;
                line-height: 1.6;
                color: #24292e;
                background: #ffffff;
                padding: 20px;
                max-width: 1000px;
                margin: 0 auto;
            }

            .back-link {
                display: inline-block;
                margin-bottom: 16px;
                color: #0366d6;
                text-decoration: none;
                font-size: 14px;
            }

            .back-link:hover {
                text-decoration: underline;
            }

            h1 {
                font-size: 32px;
                margin-bottom: 8px;
            }

            .description {
                color: #586069;
                font-size: 16px;
                margin-bottom: 24px;
            }

            .warning {
                background: #fff3cd;
                border: 1px solid #ffc107;
                border-radius: 6px;
                padding: 12px 16px;
                margin-bottom: 24px;
                font-size: 14px;
            }

            .warning strong {
                color: #856404;
            }

            .scan-container {
                display: flex;
                gap: 20px;
                margin-bottom: 20px;
            }

            .scan-section {
                background: #f6f8fa;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                padding: 20px;
                flex: 1;
            }

            .scan-section h2 {
                font-size: 20px;
                margin-bottom: 16px;
            }

            .scan-option {
                margin-bottom: 20px;
            }

            .scan-option:last-child {
                margin-bottom: 0;
            }

            .scan-option label {
                display: block;
                font-weight: 600;
                margin-bottom: 8px;
                font-size: 14px;
            }

            .scan-option p {
                color: #586069;
                font-size: 13px;
                margin-bottom: 8px;
            }

            .preset-buttons {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }

            .btn {
                background: #fafbfc;
                color: #24292e;
                padding: 8px 12px;
                border-radius: 6px;
                border: 1px solid rgba(27, 31, 35, 0.15);
                cursor: pointer;
                font-size: 14px;
                line-height: 20px;
                font-family: inherit;
            }

            .btn:hover:not(:disabled) {
                background: #f3f4f6;
            }

            .btn.primary {
                background: #0366d6;
                color: #fff;
                border-color: #0366d6;
            }

            .btn.primary:hover:not(:disabled) {
                background: #0256c5;
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .input-group {
                display: flex;
                gap: 8px;
                align-items: center;
                flex-wrap: wrap;
            }

            input[type="number"],
            input[type="text"] {
                padding: 8px 12px;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                font-size: 14px;
                font-family: inherit;
                width: 100px;
            }

            input[type="text"] {
                width: 200px;
            }

            .progress-section {
                display: none;
                background: #f6f8fa;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                padding: 20px;
                margin-bottom: 20px;
            }

            .progress-section.active {
                display: block;
            }

            .progress-bar {
                width: 100%;
                height: 24px;
                background: #e1e4e8;
                border-radius: 6px;
                overflow: hidden;
                margin-bottom: 12px;
            }

            .progress-fill {
                height: 100%;
                background: #0366d6;
                transition: width 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 12px;
                font-weight: 600;
            }

            .progress-info {
                display: flex;
                justify-content: space-between;
                font-size: 14px;
                color: #586069;
                margin-bottom: 12px;
            }

            .results-section {
                display: none;
            }

            .results-section.active {
                display: block;
            }

            .results-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
            }

            .results-header h2 {
                font-size: 20px;
            }

            .results-stats {
                display: flex;
                gap: 16px;
                margin-bottom: 16px;
                font-size: 14px;
            }

            .stat {
                padding: 8px 12px;
                background: #f6f8fa;
                border-radius: 6px;
                border: 1px solid #e1e4e8;
            }

            .stat strong {
                color: #0366d6;
            }

            .results-table {
                width: 100%;
                border-collapse: collapse;
                background: white;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                overflow: hidden;
            }

            .results-table th {
                background: #f6f8fa;
                padding: 12px;
                text-align: left;
                font-weight: 600;
                font-size: 14px;
                border-bottom: 1px solid #e1e4e8;
            }

            .results-table td {
                padding: 12px;
                border-bottom: 1px solid #e1e4e8;
                font-size: 14px;
            }

            .results-table tr:last-child td {
                border-bottom: none;
            }

            .results-table tr:hover {
                background: #f6f8fa;
            }

            .status-badge {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 600;
            }

            .status-open {
                background: #d4edda;
                color: #155724;
            }

            .status-closed {
                background: #f8d7da;
                color: #721c24;
            }

            .service-name {
                color: #586069;
                font-size: 13px;
            }

            .empty-results {
                text-align: center;
                padding: 40px;
                color: #586069;
            }

            @media (max-width: 768px) {
                body {
                    padding: 12px;
                }

                h1 {
                    font-size: 24px;
                }

                .scan-container {
                    flex-direction: column;
                }

                .input-group {
                    flex-direction: column;
                    align-items: stretch;
                }

                input[type="number"],
                input[type="text"] {
                    width: 100%;
                }

                .results-table {
                    font-size: 12px;
                }

                .results-table th,
                .results-table td {
                    padding: 8px;
                }

                .results-stats {
                    flex-direction: column;
                    gap: 8px;
                }
            }
        </style>
    </head>
    <body>
        <!-- =========================
         HTML Structure
         ========================= -->

        <a href="index.html" class="back-link">← Back to Browser Tools</a>
        <h1>Localhost Port Scanner</h1>
        <p class="description">
            Scan ports on your local machine to detect running services, Docker
            containers, and development servers.
        </p>

        <div class="warning">
            <strong> Localhost Only:</strong> This tool is designed for scanning
            127.0.0.1 (localhost) only. Only use it on your own machine for for
            development and troubleshooting purposes.
        </div>

        <div class="scan-container">
            <div class="scan-section">
                <h2>Quick Scan</h2>
                <div class="scan-option">
                    <label>Common Ports</label>
                    <p>Scan commonly used development and service ports</p>
                    <div class="preset-buttons">
                        <button class="btn" onclick="scanCommonPorts()">
                            Scan Common Ports
                        </button>
                        <button class="btn" onclick="scanWebPorts()">
                            Web Servers
                        </button>
                        <button class="btn" onclick="scanDatabasePorts()">
                            Databases
                        </button>
                        <button class="btn" onclick="scanDockerPorts()">
                            Docker Services
                        </button>
                        <button class="btn" onclick="scanAllPorts()">
                            Full Scan (All 65535 Ports)
                        </button>
                    </div>
                </div>
            </div>

            <div class="scan-section">
                <h2>Custom Scan</h2>
                <div class="scan-option">
                    <label>Port Range</label>
                    <p>
                        Scan a custom range of ports (maximum 10000 ports per
                        scan)
                    </p>
                    <div class="input-group">
                        <input
                            type="number"
                            id="startPort"
                            placeholder="Start"
                            min="1"
                            max="65535"
                            value="1"
                        />
                        <span>to</span>
                        <input
                            type="number"
                            id="endPort"
                            placeholder="End"
                            min="1"
                            max="65535"
                            value="1000"
                        />
                        <button class="btn primary" onclick="scanCustomRange()">
                            Scan Range
                        </button>
                    </div>
                </div>

                <div class="scan-option">
                    <label>Specific Ports</label>
                    <p>
                        Scan specific ports (comma-separated, e.g.,
                        80,443,3000,8080)
                    </p>
                    <div class="input-group">
                        <input
                            type="text"
                            id="specificPorts"
                            placeholder="80,443,3000"
                        />
                        <button
                            class="btn primary"
                            onclick="scanSpecificPorts()"
                        >
                            Scan Ports
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="progress-info">
                <span id="progressText">Scanning...</span>
                <span id="progressCount">0 / 0</span>
            </div>
            <button class="btn" id="stopScanBtn" onclick="stopScan()">
                Stop Scan
            </button>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2>Scan Results</h2>
                <button
                    class="btn"
                    id="clearResultsBtn"
                    onclick="clearResults()"
                >
                    Clear Results
                </button>
            </div>
            <div class="results-stats">
                <div class="stat">
                    Scanned: <strong id="totalScanned">0</strong>
                </div>
                <div class="stat">Open: <strong id="totalOpen">0</strong></div>
                <div class="stat">
                    Closed: <strong id="totalClosed">0</strong>
                </div>
                <div class="stat">
                    Duration: <strong id="scanDuration">0s</strong>
                </div>
            </div>
            <div id="resultsContainer"></div>
        </div>

        <script>
            /* =========================
         JavaScript
         ========================= */

            // State variables
            let isScanning = false;
            let shouldStop = false;
            let scanResults = [];
            let scanStartTime = 0;

            // Common port definitions
            const PORT_DEFINITIONS = {
                // Web servers
                80: "HTTP",
                443: "HTTPS",
                8080: "HTTP Alternate",
                8443: "HTTPS Alternate",
                3000: "Node.js / React Dev",
                3001: "Node.js / React Dev",
                4200: "Angular Dev",
                5000: "Flask / ASP.NET",
                5001: "Flask / ASP.NET",
                8000: "Django / Python HTTP",
                8001: "Django Alternate",
                8888: "Jupyter Notebook",
                9000: "PHP-FPM",

                // Databases
                3306: "MySQL",
                5432: "PostgreSQL",
                5433: "PostgreSQL Alternate",
                6379: "Redis",
                27017: "MongoDB",
                27018: "MongoDB Alternate",
                9042: "Cassandra",
                7000: "Cassandra JMX",
                7001: "Cassandra TLS",
                28015: "RethinkDB",

                // Docker & Container Services
                2375: "Docker HTTP",
                2376: "Docker HTTPS",
                2377: "Docker Swarm",
                9200: "Elasticsearch",
                9300: "Elasticsearch Transport",
                5601: "Kibana",
                15672: "RabbitMQ Management",
                5672: "RabbitMQ",
                8500: "Consul",
                4001: "etcd",
                2379: "etcd Client",
                2380: "etcd Peer",

                // Message Queues
                5672: "AMQP (RabbitMQ)",
                9092: "Kafka",
                9093: "Kafka Alternate",

                // Caching & Key-Value
                11211: "Memcached",
                6380: "Redis Alternate",

                // Monitoring & Metrics
                9090: "Prometheus",
                3030: "Grafana Alternate",
                8086: "InfluxDB",
                4040: "Spark UI",

                // Other Services
                22: "SSH",
                21: "FTP",
                25: "SMTP",
                110: "POP3",
                143: "IMAP",
                3389: "RDP",
                5900: "VNC",
                1433: "MS SQL Server",
                1521: "Oracle DB",
                50000: "DB2",
            };

            // Preset port groups
            const COMMON_PORTS = [
                80, 443, 3000, 3001, 4200, 5000, 8000, 8080, 8443, 3306, 5432,
                6379, 27017, 9200, 5601, 15672, 9092, 11211, 9090, 8086, 2375,
                2376,
            ];

            const WEB_PORTS = [
                80, 443, 3000, 3001, 4200, 5000, 5001, 8000, 8001, 8080, 8443,
                8888, 9000,
            ];

            const DATABASE_PORTS = [
                3306, 5432, 5433, 6379, 27017, 27018, 9042, 7000, 7001, 28015,
                1433, 1521, 50000,
            ];

            const DOCKER_PORTS = [
                2375, 2376, 2377, 9200, 9300, 5601, 15672, 5672, 8500, 4001,
                2379, 2380, 9092, 9093,
            ];

            // Scan a single port with enhanced HTTP information gathering
            async function scanPort(port, timeout = 2000) {
                const startTime = Date.now();

                // Try to gather HTTP information directly - this is the most reliable test
                const httpInfo = await gatherHttpInfo(port);

                // If we got HTTP info with a status code, the port is definitely open
                if (httpInfo.httpStatus !== null) {
                    return {
                        port,
                        status: "open",
                        method: "http",
                        elapsed: Date.now() - startTime,
                        ...httpInfo,
                    };
                }

                // HTTP didn't work, try WebSocket
                const wsResult = await checkWebSocket(port, 1000);
                if (wsResult.open) {
                    return {
                        port,
                        status: "open",
                        method: "websocket",
                        elapsed: Date.now() - startTime,
                        protocol: "WebSocket",
                        httpStatus: null,
                        server: null,
                        pageTitle: null,
                        authRequired: false,
                    };
                }

                // Nothing worked - port is closed
                return {
                    port,
                    status: "closed",
                    method: "timeout",
                    elapsed: Date.now() - startTime,
                };
            }

            // Check WebSocket connection
            async function checkWebSocket(port, timeout = 1000) {
                return new Promise((resolve) => {
                    const ws = new WebSocket(`ws://127.0.0.1:${port}`);
                    const timer = setTimeout(() => {
                        ws.close();
                        resolve({ open: false });
                    }, timeout);

                    ws.onopen = () => {
                        clearTimeout(timer);
                        ws.close();
                        resolve({ open: true });
                    };

                    ws.onerror = () => {
                        clearTimeout(timer);
                        ws.close();
                        resolve({ open: false });
                    };
                });
            }

            // Gather detailed HTTP information from an open port
            async function gatherHttpInfo(port) {
                const info = {
                    protocol: null,
                    httpStatus: null,
                    server: null,
                    pageTitle: null,
                    authRequired: false,
                };

                // Try HTTP first (more common), then HTTPS
                for (const protocol of ["http", "https"]) {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(
                            () => controller.abort(),
                            1500,
                        );

                        const response = await fetch(
                            `${protocol}://127.0.0.1:${port}/`,
                            {
                                method: "GET",
                                mode: "cors",
                                cache: "no-cache",
                                signal: controller.signal,
                            },
                        );

                        clearTimeout(timeoutId);

                        info.protocol = protocol.toUpperCase();
                        info.httpStatus = response.status;

                        // Get server header
                        info.server =
                            response.headers.get("Server") || "Unknown";

                        // Check for authentication
                        if (
                            response.status === 401 ||
                            response.status === 403
                        ) {
                            info.authRequired = true;
                        }

                        // Try to get page title from HTML
                        if (
                            response.headers
                                .get("Content-Type")
                                ?.includes("text/html")
                        ) {
                            try {
                                const html = await response.text();
                                const titleMatch = html.match(
                                    /<title[^>]*>([^<]+)<\/title>/i,
                                );
                                if (titleMatch) {
                                    info.pageTitle = titleMatch[1].trim();
                                }
                            } catch (e) {
                                // Ignore errors parsing HTML
                            }
                        }

                        break; // Successfully got info, exit loop
                    } catch (error) {
                        // Try next protocol
                        continue;
                    }
                }

                // If we got here and protocol is still null, HTTP requests failed
                // This means it's not an HTTP service or port is actually closed
                return info;
            }

            // Scan multiple ports
            async function scanPorts(ports) {
                if (isScanning) {
                    alert("A scan is already in progress");
                    return;
                }

                isScanning = true;
                shouldStop = false;
                scanResults = [];
                scanStartTime = Date.now();

                // Reset progress bar
                document.getElementById("progressFill").style.width = "0%";
                document.getElementById("progressFill").textContent = "0%";
                document.getElementById("progressText").textContent =
                    "Scanning...";
                document.getElementById("progressCount").textContent = "0 / 0";

                // Show progress section and results section
                document
                    .getElementById("progressSection")
                    .classList.add("active");
                document
                    .getElementById("resultsSection")
                    .classList.add("active");

                // Initialize results table
                document.getElementById("totalScanned").textContent = "0";
                document.getElementById("totalOpen").textContent = "0";
                document.getElementById("totalClosed").textContent = "0";
                document.getElementById("scanDuration").textContent = "0s";
                document.getElementById("resultsContainer").innerHTML = `
          <table class="results-table">
            <thead>
              <tr>
                <th>Port</th>
                <th>Status</th>
                <th>Service</th>
                <th>Protocol</th>
                <th>HTTP Status</th>
                <th>Server</th>
                <th>Page Title</th>
                <th>Auth</th>
                <th>Response Time</th>
              </tr>
            </thead>
            <tbody id="resultsTableBody">
            </tbody>
          </table>
        `;

                // Disable all scan buttons except stop and clear
                const buttons = document.querySelectorAll(".btn");
                buttons.forEach((btn) => {
                    if (
                        btn.id !== "stopScanBtn" &&
                        btn.id !== "clearResultsBtn"
                    ) {
                        btn.disabled = true;
                    }
                });

                const totalPorts = ports.length;
                let scannedPorts = 0;

                // Update progress
                function updateProgress() {
                    const percent = Math.round(
                        (scannedPorts / totalPorts) * 100,
                    );
                    document.getElementById("progressFill").style.width =
                        percent + "%";
                    document.getElementById("progressFill").textContent =
                        percent + "%";
                    document.getElementById("progressText").textContent =
                        `Scanning port ${ports[scannedPorts - 1] || "..."}`;
                    document.getElementById("progressCount").textContent =
                        `${scannedPorts} / ${totalPorts}`;
                }

                // Scan ports in batches to avoid overwhelming the browser
                const batchSize = 10;
                for (let i = 0; i < ports.length; i += batchSize) {
                    if (shouldStop) break;

                    const batch = ports.slice(i, i + batchSize);
                    const results = await Promise.all(
                        batch.map((port) => scanPort(port)),
                    );

                    scanResults.push(...results);
                    scannedPorts += batch.length;
                    updateProgress();

                    // Update results in real-time
                    updateLiveResults();
                }

                // Scan complete
                isScanning = false;
                const duration = ((Date.now() - scanStartTime) / 1000).toFixed(
                    2,
                );

                // Hide progress section
                document
                    .getElementById("progressSection")
                    .classList.remove("active");

                // Re-enable buttons
                buttons.forEach((btn) => (btn.disabled = false));

                // Final update of results
                updateLiveResults(duration);
            }

            // Update results in real-time
            function updateLiveResults(finalDuration = null) {
                const openPorts = scanResults.filter(
                    (r) => r.status === "open",
                );
                const closedPorts = scanResults.filter(
                    (r) => r.status === "closed",
                );

                // Update stats
                document.getElementById("totalScanned").textContent =
                    scanResults.length;
                document.getElementById("totalOpen").textContent =
                    openPorts.length;
                document.getElementById("totalClosed").textContent =
                    closedPorts.length;

                // Update duration
                if (finalDuration !== null) {
                    document.getElementById("scanDuration").textContent =
                        finalDuration + "s";
                } else {
                    const elapsed = (
                        (Date.now() - scanStartTime) /
                        1000
                    ).toFixed(1);
                    document.getElementById("scanDuration").textContent =
                        elapsed + "s";
                }

                // Update table body
                const tbody = document.getElementById("resultsTableBody");
                if (!tbody) return;

                if (openPorts.length === 0) {
                    tbody.innerHTML = `
            <tr>
              <td colspan="4" style="text-align: center; padding: 40px; color: #586069;">
                No open ports found yet...
              </td>
            </tr>
          `;
                    return;
                }

                // Sort by port number
                openPorts.sort((a, b) => a.port - b.port);

                let tableHTML = "";
                openPorts.forEach((result) => {
                    const service =
                        PORT_DEFINITIONS[result.port] || "Unknown Service";

                    // Format HTTP info
                    const protocol = result.protocol || "—";
                    const httpStatus = result.httpStatus || "—";
                    const server = result.server || "—";
                    const pageTitle = result.pageTitle
                        ? `<span title="${result.pageTitle}">${result.pageTitle.length > 30 ? result.pageTitle.substring(0, 30) + "..." : result.pageTitle}</span>`
                        : "—";
                    const auth = result.authRequired ? "Yes" : "—";

                    tableHTML += `
            <tr>
              <td><strong>${result.port}</strong></td>
              <td><span class="status-badge status-${result.status}">${result.status.toUpperCase()}</span></td>
              <td><span class="service-name">${service}</span></td>
              <td>${protocol}</td>
              <td>${httpStatus}</td>
              <td><span class="service-name">${server}</span></td>
              <td><span class="service-name">${pageTitle}</span></td>
              <td>${auth}</td>
              <td>${result.elapsed}ms</td>
            </tr>
          `;
                });

                tbody.innerHTML = tableHTML;
            }

            // Preset scan functions
            function scanCommonPorts() {
                scanPorts(COMMON_PORTS);
            }

            function scanWebPorts() {
                scanPorts(WEB_PORTS);
            }

            function scanDatabasePorts() {
                scanPorts(DATABASE_PORTS);
            }

            function scanDockerPorts() {
                scanPorts(DOCKER_PORTS);
            }

            // Full port scan
            function scanAllPorts() {
                const confirmed = confirm(
                    "⚠️ WARNING: This will scan all 65,535 ports which may take 20-30 minutes or longer.\n\n" +
                        "This is a comprehensive scan and may:\n" +
                        "• Take a significant amount of time\n" +
                        "• Use considerable system resources\n" +
                        "• Trigger security software alerts\n\n" +
                        "Are you sure you want to proceed?",
                );

                if (!confirmed) {
                    return;
                }

                const ports = [];
                for (let i = 1; i <= 65535; i++) {
                    ports.push(i);
                }
                scanPorts(ports);
            }

            // Custom range scan
            function scanCustomRange() {
                const start = parseInt(
                    document.getElementById("startPort").value,
                );
                const end = parseInt(document.getElementById("endPort").value);

                if (isNaN(start) || isNaN(end)) {
                    alert("Please enter valid port numbers");
                    return;
                }

                if (start < 1 || start > 65535 || end < 1 || end > 65535) {
                    alert("Port numbers must be between 1 and 65535");
                    return;
                }

                if (start > end) {
                    alert("Start port must be less than or equal to end port");
                    return;
                }

                if (end - start > 10000) {
                    alert("Maximum range is 10000 ports per scan");
                    return;
                }

                const ports = [];
                for (let i = start; i <= end; i++) {
                    ports.push(i);
                }

                scanPorts(ports);
            }

            // Specific ports scan
            function scanSpecificPorts() {
                const input = document.getElementById("specificPorts").value;
                const ports = input
                    .split(",")
                    .map((p) => parseInt(p.trim()))
                    .filter((p) => !isNaN(p) && p >= 1 && p <= 65535);

                if (ports.length === 0) {
                    alert("Please enter valid port numbers (1-65535)");
                    return;
                }

                if (ports.length > 10000) {
                    alert("Maximum 10000 ports per scan");
                    return;
                }

                scanPorts(ports);
            }

            // Stop scan
            function stopScan() {
                shouldStop = true;
                isScanning = false;
                document
                    .getElementById("progressSection")
                    .classList.remove("active");

                // Re-enable buttons
                const buttons = document.querySelectorAll(".btn");
                buttons.forEach((btn) => (btn.disabled = false));
            }

            // Clear results
            function clearResults() {
                scanResults = [];
                document
                    .getElementById("resultsSection")
                    .classList.remove("active");
                document.getElementById("resultsContainer").innerHTML = "";
            }
        </script>
    </body>
</html>
