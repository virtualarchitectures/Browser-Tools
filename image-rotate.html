<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Rotate Tool</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Helvetica, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Arial, sans-serif;
        line-height: 1.6;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        color: #24292e;
        background: #ffffff;
      }
      h1 {
        border-bottom: 1px solid #eaecef;
        padding-bottom: 0.3em;
        margin-top: 0;
        font-size: 32px;
        font-weight: 600;
      }
      .file-controls {
        background: #f6f8fa;
        padding: 16px;
        border-radius: 6px;
        border: 1px solid #e1e4e8;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 0;
      }
      .small {
        font-size: 13px;
        color: #586069;
      }
      input[type="file"] {
        display: none;
      }
      .btn {
        background: #0366d6;
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid rgba(27, 31, 35, 0.15);
        cursor: pointer;
        font-size: 14px;
        line-height: 20px;
        text-decoration: none;
        font-family: inherit;
        transition: background 0.2s;
      }
      .btn:hover {
        background: #0256c5;
      }
      .btn:disabled {
        background: #94d3a2;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .btn.secondary {
        background: #fafbfc;
        color: #24292e;
        border: 1px solid rgba(27, 31, 35, 0.15);
      }
      .btn.secondary:hover {
        background: #f3f4f6;
      }
      .btn.success {
        background: #238636;
      }
      .btn.success:hover {
        background: #2ea043;
      }
      label.btn {
        display: inline-block;
        margin: 0;
      }
      .panel {
        background: #f6f8fa;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .panel-title {
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 12px 0;
        color: #24292e;
      }
      .controls-row {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 12px;
      }
      .controls-row:last-child {
        margin-bottom: 0;
      }
      .input-label {
        font-size: 12px;
        font-weight: 500;
        color: #586069;
        min-width: 90px;
      }
      .slider-container {
        flex: 1;
        min-width: 200px;
      }
      .slider {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #d1d5da;
        outline: none;
        -webkit-appearance: none;
        appearance: none;
      }
      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #0366d6;
        cursor: pointer;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #0366d6;
        cursor: pointer;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .rotation-value {
        font-family: "Courier New", monospace;
        font-weight: 600;
        color: #0366d6;
        min-width: 60px;
        text-align: center;
      }
      .quick-rotate-btn {
        background: #fafbfc;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        color: #24292e;
        font-size: 14px;
        transition: all 0.2s;
      }
      .quick-rotate-btn:hover {
        background: #f3f4f6;
        border-color: #0366d6;
      }
      .quick-rotate-btn.active {
        background: #0366d6;
        border-color: #0366d6;
        color: white;
      }
      .flip-btn {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .editor-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }
      .editor-wrapper {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .editor-label {
        font-size: 14px;
        font-weight: 600;
        color: #24292e;
      }
      .editor {
        border: 2px dashed #d1d5da;
        border-radius: 6px;
        min-height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f6f8fa;
        position: relative;
        overflow: hidden;
      }
      .editor.drag-over {
        border-color: #0366d6;
        background: #f1f8ff;
      }
      .editor-placeholder {
        color: #586069;
        text-align: center;
        padding: 20px;
      }
      .editor img {
        max-width: 100%;
        max-height: 500px;
        display: block;
      }
      .preview-canvas {
        max-width: 100%;
        max-height: 500px;
        display: block;
        margin: 0 auto;
      }
      .dimension-info {
        display: flex;
        gap: 16px;
        font-size: 13px;
        color: #586069;
        margin-top: 8px;
      }
      .download-controls {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }
      .back-link {
        color: #0366d6;
        text-decoration: none;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        margin-bottom: 16px;
      }
      .back-link:hover {
        text-decoration: underline;
      }
      @media (max-width: 900px) {
        .editor-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <a href="index.html" class="back-link">← Back to Tools</a>

    <h1>Image Rotate Tool</h1>

    <div class="file-controls">
      <label for="fileInput" class="btn">Choose Image</label>
      <input type="file" id="fileInput" accept="image/*" />
      <span id="fileStatus" class="small" style="margin-left: 8px">No file selected</span>
      <button id="clearImageBtn" class="btn secondary" style="margin-left: auto" disabled>
        Clear Image
      </button>
    </div>

    <div class="panel">
      <h3 class="panel-title">Rotation Controls</h3>

      <div class="controls-row">
        <span class="input-label">Quick Rotate:</span>
        <button class="quick-rotate-btn" data-rotate="-90" title="Rotate 90° counter-clockwise">↺ 90°</button>
        <button class="quick-rotate-btn" data-rotate="90" title="Rotate 90° clockwise">↻ 90°</button>
        <button class="quick-rotate-btn" data-rotate="180" title="Rotate 180°">↻ 180°</button>
        <button class="quick-rotate-btn" id="resetRotationBtn" title="Reset rotation">Reset</button>
      </div>

      <div class="controls-row">
        <span class="input-label">Fine Rotation:</span>
        <div class="slider-container">
          <input type="range" id="rotationSlider" class="slider" min="-180" max="180" value="0" step="0.5" />
        </div>
        <span id="rotationValue" class="rotation-value">0°</span>
      </div>

      <div class="controls-row">
        <span class="input-label">Flip:</span>
        <button class="quick-rotate-btn flip-btn" id="flipHorizontalBtn" title="Flip horizontally">↔ Horizontal</button>
        <button class="quick-rotate-btn flip-btn" id="flipVerticalBtn" title="Flip vertically">↕ Vertical</button>
      </div>
    </div>

    <div class="editor-container">
      <div class="editor-wrapper">
        <div class="editor-label">Original</div>
        <div id="editorArea" class="editor">
          <div class="editor-placeholder">
            Drop an image here or use "Choose Image" button
          </div>
        </div>
        <div id="originalDimensionInfo" class="dimension-info"></div>
      </div>

      <div class="editor-wrapper">
        <div class="editor-label">Preview</div>
        <div id="previewArea" class="editor">
          <div class="editor-placeholder">Preview will appear here</div>
        </div>
        <div id="previewDimensionInfo" class="dimension-info"></div>
      </div>
    </div>

    <div class="download-controls">
      <button id="downloadBtn" class="btn success" style="display: none;">
        Download Image
      </button>
    </div>

    <script>
      // DOM Elements
      const fileInput = document.getElementById("fileInput");
      const fileStatus = document.getElementById("fileStatus");
      const clearImageBtn = document.getElementById("clearImageBtn");
      const editorArea = document.getElementById("editorArea");
      const previewArea = document.getElementById("previewArea");
      const originalDimensionInfo = document.getElementById("originalDimensionInfo");
      const previewDimensionInfo = document.getElementById("previewDimensionInfo");
      const rotationSlider = document.getElementById("rotationSlider");
      const rotationValue = document.getElementById("rotationValue");
      const resetRotationBtn = document.getElementById("resetRotationBtn");
      const flipHorizontalBtn = document.getElementById("flipHorizontalBtn");
      const flipVerticalBtn = document.getElementById("flipVerticalBtn");
      const downloadBtn = document.getElementById("downloadBtn");

      // State
      let originalImage = null;
      let originalFileName = "";
      let rotation = 0;
      let flipH = false;
      let flipV = false;

      // Event Listeners
      fileInput.addEventListener("change", handleFileSelect);
      clearImageBtn.addEventListener("click", clearImage);
      editorArea.addEventListener("dragover", handleDragOver);
      editorArea.addEventListener("dragleave", handleDragLeave);
      editorArea.addEventListener("drop", handleDrop);
      rotationSlider.addEventListener("input", handleRotationSlider);
      resetRotationBtn.addEventListener("click", resetRotation);
      flipHorizontalBtn.addEventListener("click", () => toggleFlip("horizontal"));
      flipVerticalBtn.addEventListener("click", () => toggleFlip("vertical"));
      downloadBtn.addEventListener("click", downloadImage);

      // Quick rotate buttons
      document.querySelectorAll(".quick-rotate-btn[data-rotate]").forEach(btn => {
        btn.addEventListener("click", () => {
          const rotateAmount = parseInt(btn.dataset.rotate);
          rotation = (rotation + rotateAmount) % 360;
          if (rotation > 180) rotation -= 360;
          if (rotation < -180) rotation += 360;
          rotationSlider.value = rotation;
          rotationValue.textContent = `${rotation}°`;
          updatePreview();
        });
      });

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          loadImage(file);
        }
      }

      function handleDragOver(e) {
        e.preventDefault();
        editorArea.classList.add("drag-over");
      }

      function handleDragLeave(e) {
        e.preventDefault();
        editorArea.classList.remove("drag-over");
      }

      function handleDrop(e) {
        e.preventDefault();
        editorArea.classList.remove("drag-over");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          loadImage(file);
        }
      }

      function loadImage(file) {
        const reader = new FileReader();

        reader.onload = function (e) {
          const img = new Image();
          img.onload = function () {
            originalImage = img;
            originalFileName = file.name;

            // Reset transforms
            rotation = 0;
            flipH = false;
            flipV = false;
            rotationSlider.value = 0;
            rotationValue.textContent = "0°";
            flipHorizontalBtn.classList.remove("active");
            flipVerticalBtn.classList.remove("active");

            // Display original image
            editorArea.innerHTML = "";
            const displayImg = document.createElement("img");
            displayImg.src = e.target.result;
            editorArea.appendChild(displayImg);

            // Update UI
            fileStatus.textContent = `${file.name} loaded`;
            clearImageBtn.disabled = false;
            originalDimensionInfo.textContent = `${img.naturalWidth} × ${img.naturalHeight} px`;

            // Initial preview
            updatePreview();
          };
          img.src = e.target.result;
        };

        reader.readAsDataURL(file);
      }

      function handleRotationSlider() {
        rotation = parseFloat(rotationSlider.value);
        rotationValue.textContent = `${rotation}°`;
        updatePreview();
      }

      function resetRotation() {
        rotation = 0;
        flipH = false;
        flipV = false;
        rotationSlider.value = 0;
        rotationValue.textContent = "0°";
        flipHorizontalBtn.classList.remove("active");
        flipVerticalBtn.classList.remove("active");
        updatePreview();
      }

      function toggleFlip(direction) {
        if (direction === "horizontal") {
          flipH = !flipH;
          flipHorizontalBtn.classList.toggle("active", flipH);
        } else {
          flipV = !flipV;
          flipVerticalBtn.classList.toggle("active", flipV);
        }
        updatePreview();
      }

      function createTransformedCanvas() {
        const radians = (rotation * Math.PI) / 180;
        const cos = Math.abs(Math.cos(radians));
        const sin = Math.abs(Math.sin(radians));

        const origW = originalImage.naturalWidth;
        const origH = originalImage.naturalHeight;

        // Calculate new dimensions after rotation
        const newWidth = Math.ceil(origW * cos + origH * sin);
        const newHeight = Math.ceil(origH * cos + origW * sin);

        const canvas = document.createElement("canvas");
        canvas.width = newWidth;
        canvas.height = newHeight;
        const ctx = canvas.getContext("2d");

        ctx.translate(newWidth / 2, newHeight / 2);
        ctx.rotate(radians);
        ctx.scale(flipH ? -1 : 1, flipV ? -1 : 1);
        ctx.drawImage(originalImage, -origW / 2, -origH / 2);

        return canvas;
      }

      function updatePreview() {
        if (!originalImage) return;

        const canvas = createTransformedCanvas();

        // Calculate preview dimensions
        const maxWidth = previewArea.clientWidth - 20;
        const maxHeight = 500;
        const previewScale = Math.min(maxWidth / canvas.width, maxHeight / canvas.height, 1);

        // Create preview canvas
        const previewCanvas = document.createElement("canvas");
        previewCanvas.className = "preview-canvas";
        previewCanvas.width = canvas.width;
        previewCanvas.height = canvas.height;
        previewCanvas.style.width = `${canvas.width * previewScale}px`;
        previewCanvas.style.height = `${canvas.height * previewScale}px`;

        const ctx = previewCanvas.getContext("2d");
        ctx.drawImage(canvas, 0, 0);

        previewArea.innerHTML = "";
        previewArea.appendChild(previewCanvas);
        previewDimensionInfo.textContent = `${canvas.width} × ${canvas.height} px`;
        downloadBtn.style.display = "inline-block";
      }

      function clearImage() {
        originalImage = null;
        originalFileName = "";
        rotation = 0;
        flipH = false;
        flipV = false;
        rotationSlider.value = 0;
        rotationValue.textContent = "0°";
        flipHorizontalBtn.classList.remove("active");
        flipVerticalBtn.classList.remove("active");

        editorArea.innerHTML = '<div class="editor-placeholder">Drop an image here or use "Choose Image" button</div>';
        previewArea.innerHTML = '<div class="editor-placeholder">Preview will appear here</div>';

        fileInput.value = "";
        fileStatus.textContent = "No file selected";
        clearImageBtn.disabled = true;
        originalDimensionInfo.textContent = "";
        previewDimensionInfo.textContent = "";
        downloadBtn.style.display = "none";
      }

      function downloadImage() {
        if (!originalImage) return;

        const canvas = createTransformedCanvas();

        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");

          // Generate filename
          let filename = "rotated";
          let extension = "png";

          if (originalFileName) {
            const lastDot = originalFileName.lastIndexOf(".");
            if (lastDot > 0) {
              filename = originalFileName.substring(0, lastDot);
              extension = originalFileName.substring(lastDot + 1);
            } else {
              filename = originalFileName;
            }
          }

          const transforms = [];
          if (rotation !== 0) transforms.push(`rot${rotation}`);
          if (flipH) transforms.push("flipH");
          if (flipV) transforms.push("flipV");
          const transformSuffix = transforms.length > 0 ? `-${transforms.join("-")}` : "";

          a.href = url;
          a.download = `${filename}${transformSuffix}.${extension}`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, "image/png");
      }
    </script>
  </body>
</html>
