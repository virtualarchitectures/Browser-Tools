<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Resize Tool</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Helvetica, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Arial, sans-serif;
        line-height: 1.6;
        max-width: 980px;
        margin: 0 auto;
        padding: 20px;
        color: #24292e;
        background: #ffffff;
      }
      h1 {
        border-bottom: 1px solid #eaecef;
        padding-bottom: 0.3em;
        margin-top: 0;
        font-size: 32px;
        font-weight: 600;
      }
      .file-controls {
        background: #f6f8fa;
        padding: 16px;
        border-radius: 6px;
        border: 1px solid #e1e4e8;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 0;
      }
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }
      .small {
        font-size: 13px;
        color: #586069;
      }
      input[type="file"] {
        display: none;
      }
      .btn {
        background: #0366d6;
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid rgba(27, 31, 35, 0.15);
        cursor: pointer;
        font-size: 14px;
        line-height: 20px;
        text-decoration: none;
        font-family: inherit;
        transition: background 0.2s;
      }
      .btn:hover {
        background: #0256c5;
      }
      .btn:disabled {
        background: #94d3a2;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .btn.secondary {
        background: #fafbfc;
        color: #24292e;
        border: 1px solid rgba(27, 31, 35, 0.15);
      }
      .btn.secondary:hover {
        background: #f3f4f6;
      }
      label.btn {
        display: inline-block;
        margin: 0;
      }
      .panel {
        background: #f6f8fa;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .resize-panel {
        background: #f6f8fa;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
        color: #24292e;
      }
      .resize-title {
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 12px 0;
        color: #24292e;
      }
      .resize-mode {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
      }
      .radio-label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        color: #24292e;
      }
      .radio-label input[type="radio"] {
        cursor: pointer;
      }
      .resize-inputs {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 12px;
        align-items: center;
        margin-bottom: 16px;
      }
      .input-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .input-label {
        font-size: 12px;
        font-weight: 500;
        color: #586069;
      }
      .resize-input {
        background: #ffffff;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 8px 10px;
        color: #24292e;
        font-size: 14px;
        font-family: inherit;
        width: 100%;
      }
      .resize-input:focus {
        outline: none;
        border-color: #0366d6;
        box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3);
      }
      .resize-input:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .lock-btn {
        background: #fafbfc;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        color: #24292e;
        font-size: 18px;
        line-height: 1;
        transition: all 0.2s;
        min-width: 42px;
        height: 42px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 18px;
      }
      .lock-btn:hover {
        background: #f3f4f6;
      }
      .lock-btn.locked {
        background: #0366d6;
        border-color: #0366d6;
        color: white;
      }
      .lock-btn.locked:hover {
        background: #0256c5;
      }
      .ratio-section {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #d1d5da;
      }
      .ratio-display {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 16px;
      }
      .scale-item {
        background: #ffffff;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 12px;
      }
      .scale-label {
        font-size: 12px;
        color: #586069;
        margin-bottom: 4px;
      }
      .scale-value {
        font-weight: 600;
        color: #0366d6;
        font-family: "Courier New", monospace;
        font-size: 16px;
      }
      .scale-info {
        font-size: 12px;
        color: #586069;
        line-height: 1.5;
      }
      .scale-factor-input {
        background: #ffffff;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        padding: 12px;
        color: #24292e;
        font-size: 14px;
        font-family: "Courier New", monospace;
        width: 100%;
        resize: vertical;
        min-height: 42px;
      }
      .scale-factor-input:focus {
        outline: none;
        border-color: #0366d6;
        box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3);
      }
      .copy-scale-btn {
        background: #238636;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: background 0.2s;
        margin-top: 8px;
      }
      .copy-scale-btn:hover {
        background: #2ea043;
      }
      .button-container {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 12px;
      }
      .download-controls {
        display: flex;
        justify-content: flex-end;
      }
      .viewer-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }
      .viewer-wrapper {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .viewer-label {
        font-size: 14px;
        font-weight: 600;
        color: #24292e;
      }
      .viewer {
        border: 2px dashed #d1d5da;
        border-radius: 6px;
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f6f8fa;
        position: relative;
        overflow: auto;
      }
      .viewer.drag-over {
        border-color: #0366d6;
        background: #f1f8ff;
      }
      .viewer img {
        max-width: 100%;
        max-height: 500px;
        display: block;
      }
      .viewer-placeholder {
        color: #586069;
        text-align: center;
        padding: 20px;
      }
      .info {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 16px;
        font-size: 14px;
        color: #856404;
      }
      .info strong {
        display: block;
        margin-bottom: 4px;
      }
      .dimension-info {
        display: flex;
        gap: 16px;
        font-size: 13px;
        color: #586069;
        margin-top: 8px;
      }
      .back-link {
        color: #0366d6;
        text-decoration: none;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        margin-bottom: 16px;
      }
      .back-link:hover {
        text-decoration: underline;
      }
      @media (max-width: 768px) {
        .viewer-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <a href="index.html" class="back-link">‚Üê Back to Tools</a>

    <h1>Image Resize Tool</h1>

    <div class="file-controls">
      <label for="fileInput" class="btn">Choose Image</label>
      <input type="file" id="fileInput" accept="image/*" />
      <span id="fileStatus" class="small" style="margin-left: 8px"
        >No file selected</span
      >
      <button
        id="clearImageBtn"
        class="btn secondary"
        style="margin-left: auto"
        disabled
      >
        Clear Image
      </button>
    </div>

    <div id="resizePanel" class="resize-panel">
      <h3 class="resize-title">Resize</h3>

      <div class="resize-mode">
        <label class="radio-label">
          <input type="radio" name="resizeMode" value="percentage" checked />
          <span>Percentage</span>
        </label>
        <label class="radio-label">
          <input type="radio" name="resizeMode" value="pixels" />
          <span>Pixels</span>
        </label>
        <label class="radio-label">
          <input type="radio" name="resizeMode" value="scalefactor" />
          <span>Scale Factor</span>
        </label>
      </div>

      <div class="resize-inputs" id="standardInputs">
        <div class="input-group">
          <label class="input-label">Horizontal</label>
          <input
            type="number"
            id="horizontalInput"
            class="resize-input"
            value=""
            min="1"
            placeholder="100"
          />
        </div>

        <button id="lockBtn" class="lock-btn locked" title="Lock aspect ratio">
          üîí
        </button>

        <div class="input-group">
          <label class="input-label">Vertical</label>
          <input
            type="number"
            id="verticalInput"
            class="resize-input"
            value=""
            min="1"
            placeholder="100"
          />
        </div>
      </div>

      <div id="scaleFactorInputContainer" style="display: none">
        <div class="input-group">
          <label class="input-label">Paste Scale Factor Values</label>
          <textarea
            id="scaleFactorInput"
            class="scale-factor-input"
            placeholder='{"width": 83.16024844720497, "height": 83.16024844720497}'
          ></textarea>
        </div>
        <div class="button-container">
          <button id="applyScaleFactorBtn" class="btn">
            Apply Scale Factor
          </button>
        </div>
      </div>

      <div class="ratio-section">
        <div class="input-group">
          <label class="input-label">Scale Factor (JSON)</label>
          <textarea
            id="scaleFactorDisplay"
            class="scale-factor-input"
            readonly
            style="min-height: 42px; background: #ffffff; cursor: text"
          ></textarea>
        </div>

        <div class="scale-info">
          Copy this scale factor and paste into Scale Factor mode to apply exact
          scaling to other images.
        </div>
        <div class="button-container">
          <button id="copyScaleBtn" class="copy-scale-btn">
            Copy Scale Factor
          </button>
        </div>
      </div>
    </div>

    <div class="viewer-container">
      <div class="viewer-wrapper">
        <div class="viewer-label">Original</div>
        <div id="originalViewer" class="viewer">
          <div class="viewer-placeholder">
            Drop an image here or use "Choose Image" button
          </div>
        </div>
        <div id="originalDimensionInfo" class="dimension-info"></div>
      </div>

      <div class="viewer-wrapper">
        <div class="viewer-label">Resized Preview</div>
        <div id="resizedViewer" class="viewer">
          <div class="viewer-placeholder">Preview will appear here</div>
        </div>
        <div id="resizedDimensionInfo" class="dimension-info"></div>
      </div>
    </div>

    <div class="download-controls">
      <button id="downloadBtn" class="btn" style="display: none">
        Download Resized Image
      </button>
    </div>

    <script>
      // DOM Elements
      const fileInput = document.getElementById("fileInput");
      const fileStatus = document.getElementById("fileStatus");
      const clearImageBtn = document.getElementById("clearImageBtn");
      const originalViewer = document.getElementById("originalViewer");
      const resizedViewer = document.getElementById("resizedViewer");
      const originalDimensionInfo = document.getElementById(
        "originalDimensionInfo"
      );
      const resizedDimensionInfo = document.getElementById(
        "resizedDimensionInfo"
      );
      const resizePanel = document.getElementById("resizePanel");
      const horizontalInput = document.getElementById("horizontalInput");
      const verticalInput = document.getElementById("verticalInput");
      const lockBtn = document.getElementById("lockBtn");
      const scaleFactorDisplay = document.getElementById("scaleFactorDisplay");
      const downloadBtn = document.getElementById("downloadBtn");
      const standardInputs = document.getElementById("standardInputs");
      const scaleFactorInputContainer = document.getElementById(
        "scaleFactorInputContainer"
      );
      const scaleFactorInput = document.getElementById("scaleFactorInput");
      const applyScaleFactorBtn = document.getElementById(
        "applyScaleFactorBtn"
      );
      const copyScaleBtn = document.getElementById("copyScaleBtn");

      // State
      let originalImage = null;
      let originalWidth = 0;
      let originalHeight = 0;
      let isLocked = true;
      let currentMode = "percentage";
      let resizedCanvas = null;
      let isUpdatingFromScale = false;
      let storedHorizontalScale = 100;
      let storedVerticalScale = 100;

      // Radio buttons
      const radioButtons = document.querySelectorAll(
        'input[name="resizeMode"]'
      );

      // Event Listeners
      fileInput.addEventListener("change", handleFileSelect);
      clearImageBtn.addEventListener("click", clearImage);
      originalViewer.addEventListener("dragover", handleDragOver);
      originalViewer.addEventListener("dragleave", handleDragLeave);
      originalViewer.addEventListener("drop", handleDrop);
      lockBtn.addEventListener("click", toggleLock);
      horizontalInput.addEventListener("input", handleHorizontalChange);
      verticalInput.addEventListener("input", handleVerticalChange);
      downloadBtn.addEventListener("click", downloadResizedImage);
      applyScaleFactorBtn.addEventListener("click", applyScaleFactor);
      copyScaleBtn.addEventListener("click", copyScaleToClipboard);

      radioButtons.forEach((radio) => {
        radio.addEventListener("change", handleModeChange);
      });

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          loadImage(file);
        }
      }

      function handleDragOver(e) {
        e.preventDefault();
        originalViewer.classList.add("drag-over");
      }

      function handleDragLeave(e) {
        e.preventDefault();
        originalViewer.classList.remove("drag-over");
      }

      function handleDrop(e) {
        e.preventDefault();
        originalViewer.classList.remove("drag-over");

        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          loadImage(file);
        }
      }

      function loadImage(file) {
        const reader = new FileReader();

        reader.onload = function (e) {
          const img = new Image();
          img.onload = function () {
            originalImage = img;
            originalWidth = img.naturalWidth;
            originalHeight = img.naturalHeight;

            // Display original image
            originalViewer.innerHTML = "";
            originalViewer.appendChild(img);

            // Update UI
            fileStatus.textContent = `${file.name} loaded`;
            clearImageBtn.disabled = false;
            originalDimensionInfo.textContent = `${originalWidth} √ó ${originalHeight} px`;

            // Reset inputs
            horizontalInput.value =
              currentMode === "percentage" ? 100 : originalWidth;
            verticalInput.value =
              currentMode === "percentage" ? 100 : originalHeight;
            isLocked = true;
            updateLockButton();

            // Initial resize
            updateResize();
          };
          img.src = e.target.result;
        };

        reader.readAsDataURL(file);
      }

      function clearImage() {
        originalImage = null;
        originalWidth = 0;
        originalHeight = 0;
        originalViewer.innerHTML =
          '<div class="viewer-placeholder">Drop an image here or use "Choose Image" button</div>';
        resizedViewer.innerHTML =
          '<div class="viewer-placeholder">Preview will appear here</div>';
        fileInput.value = "";
        fileStatus.textContent = "No file selected";
        clearImageBtn.disabled = true;
        originalDimensionInfo.textContent = "";
        resizedDimensionInfo.textContent = "";
        horizontalInput.value = "";
        verticalInput.value = "";
        scaleFactorInput.value = "";
        downloadBtn.style.display = "none";
        storedHorizontalScale = 100;
        storedVerticalScale = 100;
        scaleFactorDisplay.value = "";
      }

      function toggleLock() {
        isLocked = !isLocked;
        updateLockButton();
      }

      function updateLockButton() {
        if (isLocked) {
          lockBtn.classList.add("locked");
          lockBtn.textContent = "üîí";
          lockBtn.title = "Unlock aspect ratio";
        } else {
          lockBtn.classList.remove("locked");
          lockBtn.textContent = "üîì";
          lockBtn.title = "Lock aspect ratio";
        }
      }

      function handleModeChange(e) {
        currentMode = e.target.value;

        // Toggle UI visibility based on mode
        if (currentMode === "scalefactor") {
          standardInputs.style.display = "none";
          scaleFactorInputContainer.style.display = "block";
        } else {
          standardInputs.style.display = "grid";
          scaleFactorInputContainer.style.display = "none";

          if (originalImage) {
            if (currentMode === "percentage") {
              horizontalInput.value = 100;
              verticalInput.value = 100;
            } else {
              horizontalInput.value = originalWidth;
              verticalInput.value = originalHeight;
            }
            updateResize();
          }
        }
      }

      function handleHorizontalChange() {
        if (isLocked && originalImage && !isUpdatingFromScale) {
          const horizontal = parseFloat(horizontalInput.value) || 0;

          if (currentMode === "percentage") {
            verticalInput.value = horizontal;
          } else {
            const aspectRatio = originalHeight / originalWidth;
            verticalInput.value = Math.round(horizontal * aspectRatio);
          }
        }
        updateResize();
      }

      function handleVerticalChange() {
        if (isLocked && originalImage && !isUpdatingFromScale) {
          const vertical = parseFloat(verticalInput.value) || 0;

          if (currentMode === "percentage") {
            horizontalInput.value = vertical;
          } else {
            const aspectRatio = originalWidth / originalHeight;
            horizontalInput.value = Math.round(vertical * aspectRatio);
          }
        }
        updateResize();
      }

      function updateResize() {
        if (!originalImage) return;

        let newWidth, newHeight;

        if (currentMode === "percentage") {
          const horizontalPercent = parseFloat(horizontalInput.value) || 100;
          const verticalPercent = parseFloat(verticalInput.value) || 100;

          // Store the scale factors
          storedHorizontalScale = horizontalPercent;
          storedVerticalScale = verticalPercent;

          newWidth = Math.round(originalWidth * (horizontalPercent / 100));
          newHeight = Math.round(originalHeight * (verticalPercent / 100));
        } else {
          const inputWidth = parseInt(horizontalInput.value) || originalWidth;
          const inputHeight = parseInt(verticalInput.value) || originalHeight;

          // Calculate and store scale factors from input values
          storedHorizontalScale = (inputWidth / originalWidth) * 100;
          storedVerticalScale = (inputHeight / originalHeight) * 100;

          newWidth = inputWidth;
          newHeight = inputHeight;
        }

        // Create canvas for resizing
        const canvas = document.createElement("canvas");
        canvas.width = newWidth;
        canvas.height = newHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(originalImage, 0, 0, newWidth, newHeight);

        // Display resized image
        resizedCanvas = canvas;
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const img = new Image();
          img.onload = function () {
            resizedViewer.innerHTML = "";
            resizedViewer.appendChild(img);
            resizedDimensionInfo.textContent = `${newWidth} √ó ${newHeight} px`;
            downloadBtn.style.display = "inline-block";
            URL.revokeObjectURL(url);
          };
          img.src = url;
        });

        // Update scale factor display
        updateScaleDisplay();
      }

      function updateScaleDisplay() {
        const scaleData = {
          width: storedHorizontalScale,
          height: storedVerticalScale,
        };
        scaleFactorDisplay.value = JSON.stringify(scaleData);
      }

      function applyScaleFactor() {
        if (!originalImage) return;

        try {
          const scaleData = JSON.parse(scaleFactorInput.value.trim());

          if (
            typeof scaleData.width !== "number" ||
            typeof scaleData.height !== "number"
          ) {
            alert(
              'Invalid scale factor format. Expected: {"width": number, "height": number}'
            );
            return;
          }

          // Store the exact scale factors
          storedHorizontalScale = scaleData.width;
          storedVerticalScale = scaleData.height;

          // Calculate pixel dimensions
          const newWidth = Math.round(originalWidth * (scaleData.width / 100));
          const newHeight = Math.round(
            originalHeight * (scaleData.height / 100)
          );

          // Create canvas for resizing
          const canvas = document.createElement("canvas");
          canvas.width = newWidth;
          canvas.height = newHeight;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(originalImage, 0, 0, newWidth, newHeight);

          // Display resized image
          resizedCanvas = canvas;
          canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const img = new Image();
            img.onload = function () {
              resizedViewer.innerHTML = "";
              resizedViewer.appendChild(img);
              resizedDimensionInfo.textContent = `${newWidth} √ó ${newHeight} px`;
              downloadBtn.style.display = "inline-block";
              URL.revokeObjectURL(url);
            };
            img.src = url;
          });

          // Update scale factor display
          updateScaleDisplay();
        } catch (e) {
          alert(
            'Invalid JSON format. Please paste a valid scale factor like:\n{"width": 83.1602, "height": 83.1602}'
          );
        }
      }

      async function copyScaleToClipboard() {
        const scaleData = JSON.stringify({
          width: storedHorizontalScale,
          height: storedVerticalScale,
        });

        try {
          await navigator.clipboard.writeText(scaleData);
          const originalText = copyScaleBtn.textContent;
          copyScaleBtn.textContent = "Copied!";
          copyScaleBtn.style.background = "#1a7f37";
          setTimeout(() => {
            copyScaleBtn.textContent = originalText;
            copyScaleBtn.style.background = "#238636";
          }, 2000);
        } catch (err) {
          // Fallback for older browsers
          const textarea = document.createElement("textarea");
          textarea.value = scaleData;
          textarea.style.position = "fixed";
          textarea.style.opacity = "0";
          document.body.appendChild(textarea);
          textarea.select();
          try {
            document.execCommand("copy");
            copyScaleBtn.textContent = "Copied!";
            setTimeout(() => {
              copyScaleBtn.textContent = "Copy Scale Factor";
            }, 2000);
          } catch (err2) {
            alert("Failed to copy. Please copy manually:\n" + scaleData);
          }
          document.body.removeChild(textarea);
        }
      }

      function downloadResizedImage() {
        if (!resizedCanvas) return;

        resizedCanvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          const width = resizedCanvas.width;
          const height = resizedCanvas.height;
          a.href = url;
          a.download = `resized-${width}x${height}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, "image/png");
      }
    </script>
  </body>
</html>
